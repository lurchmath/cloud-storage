var dialogHTML="data:text/html;base64,PGh0bWw+PGhlYWQ+PHN0eWxlIHJlbD0ic3R5bGVzaGVldCI+Ym9keXttYXJnaW46MH0jYnV0dG9uc0Zvb3Rlcntwb3NpdGlvbjpmaXhlZDtib3R0b206MDt3aWR0aDoxMDAlO3RleHQtYWxpZ246cmlnaHQ7YmFja2dyb3VuZC1jb2xvcjojZWVlfS5zZWxlY3RlZEl0ZW17YmFja2dyb3VuZC1jb2xvcjojZWVlfTwvc3R5bGU+PHNjcmlwdCBzcmM9Ii4vZGlhbG9nLmpzIj48L3NjcmlwdD48L2hlYWQ+PGJvZHk+PGRpdiBpZD0iZmlsZXNMaXN0Ij48L2Rpdj48ZGl2IGlkPSJidXR0b25zRm9vdGVyIj48aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImZpbGVOYW1lSW5wdXQiPiA8aW5wdXQgdHlwZT0iYnV0dG9uIiB2YWx1ZT0iQ2FuY2VsIiBpZD0iY2FuY2VsQnV0dG9uIj4gPGlucHV0IHR5cGU9ImJ1dHRvbiIgdmFsdWU9Ik9wZW4iIGlkPSJvcGVuQnV0dG9uIj4gPGlucHV0IHR5cGU9ImJ1dHRvbiIgdmFsdWU9IlNhdmUiIGlkPSJzYXZlQnV0dG9uIj48L2Rpdj48L2JvZHk+PC9odG1sPg==";!function(){function e(){d.style.display="block"}function t(){d.style.display="none"}function n(){var e=Array.prototype.slice.apply(arguments);e.shift().contentWindow.postMessage(e,"*")}function i(){return d||((d=document.createElement("iframe")).style.position="absolute",d.style.top="50%",d.style.left="50%",d.style.width="600px",d.style.height="400px",d.style.marginTop="-200px",d.style.marginLeft="-300px",d.style.border="2px solid black",d.style.zIndex="100",t(),document.body.appendChild(d)),d}function l(e,t){function n(){e.removeEventListener("load",n,!1),t()}e.setAttribute("src",dialogHTML),e.addEventListener("load",n,!1)}function o(e){".."==e?u.pop():u.push(e)}function c(){console.log("Success callback:",Array.prototype.slice.apply(arguments))}function a(){console.log("Failure callback:",Array.prototype.slice.apply(arguments))}var s,d;setFileSystem=window.setFileSystem=function(e){s=e};var r,u=[];window.addEventListener("message",function(e){if(e.data instanceof Array){var t=e.data.shift(),n=e.data;r&&r(t,n)}}),openFile=window.openFile=function(d,p,f){d||(d=c),p||(p=a);var y=f||i();l(y,function(){s.getAccess(function(){n(y,"setDialogType","open"),r=function(e,n){if("dialogBrowse"==e)o(n[0]),openFile(d,p);else if("dialogOpen"==e){y!=f&&t();var i=u.concat([n[0]]);d({path:i,get:function(e,t){e||(e=c),t||(t=a),s.readFile(i,e,t)},update:function(e,t,n){t||(t=c),n||(n=a),s.writeFile(i,e,t,n)}})}else y!=f&&t(),p("User canceled dialog.")},s.readFolder(u,function(e){e.unshift("showList"),n.apply(null,[y].concat(e))},p),y!=f&&e()},p)})},saveFile=window.saveFile=function(d,p,f){d||(d=c),p||(p=a);var y=f||i();l(y,function(){s.getAccess(function(){n(y,"setDialogType","save"),r=function(e,n){if("dialogBrowse"==e)o(n[0]),saveFile(d,p);else if("dialogSave"==e){y!=f&&t();var i=u.concat([n[0]]);d({path:i,update:function(e,t,n){t||(t=c),n||(n=a),s.writeFile(i,e,t,n)}})}else y!=f&&t(),p("User canceled dialog.")},s.readFolder(u,function(e){e.unshift("showList"),n.apply(null,[y].concat(e))},p),y!=f&&e()},p)})},JSONFileSystem=window.JSONFileSystem=function(e){function t(t,n){for(var i=e,l=0;l<t.length;l++){if(!i.hasOwnProperty("contents"))throw"Invalid JSON filesystem structure in "+t;if(!i.contents.hasOwnProperty(t[l]))throw"Could not find the folder specified: "+t;i=i.contents[t[l]]}if(i.type!=n)throw"Path does not point to a "+n+": "+t;return i}return{contents:e,getAccess:function(e,t){e()},readFolder:function(n,i,l){try{var o=t(n,"folder"),c=[];for(var a in o.contents)o.contents.hasOwnProperty(a)&&c.push({name:a,type:o.contents[a].type});o!=e&&c.unshift({name:"..",type:"folder"}),i(c)}catch(e){l(e)}},readFile:function(e,n,i){try{n(t(e,"file").contents)}catch(e){i(e)}},writeFile:function(e,n,i,l){try{t(e,"file").contents=n,i("File updated successfully.")}catch(c){if(/Could not find/.test(c))try{var o=(e=e.slice()).pop();t(e,"folder").contents[o]={type:"file",contents:n},i("File written successfully.")}catch(e){l(e)}else l(c)}}}}}();