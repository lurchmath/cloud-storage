var dialogHTML="data:text/html;base64,PGh0bWw+PGhlYWQ+PHN0eWxlIHJlbD0ic3R5bGVzaGVldCI+Ym9keXttYXJnaW46MH0jYnV0dG9uc0Zvb3Rlcntwb3NpdGlvbjpmaXhlZDtib3R0b206MDt3aWR0aDoxMDAlO3RleHQtYWxpZ246cmlnaHQ7YmFja2dyb3VuZC1jb2xvcjojZWVlfS5zZWxlY3RlZEl0ZW17YmFja2dyb3VuZC1jb2xvcjojZWVlfTwvc3R5bGU+PHNjcmlwdD5mdW5jdGlvbiB0ZWxsUGFyZW50KGUpe3BhcmVudC5wb3N0TWVzc2FnZShlLCIqIil9ZnVuY3Rpb24gYWRkQ2xhc3MoZSx0KXt2YXIgbj1lLmdldEF0dHJpYnV0ZSgiY2xhc3MiKS5zcGxpdCgiICIpO24ucHVzaCh0KSxlLnNldEF0dHJpYnV0ZSgiY2xhc3MiLG4uam9pbigiICIpKX1mdW5jdGlvbiByZW1vdmVDbGFzcyhlLHQpe2Zvcih2YXIgbj1lLmdldEF0dHJpYnV0ZSgiY2xhc3MiKS5zcGxpdCgiICIpLGk9bi5sZW5ndGgtMTtpPj0wO2ktLSluW2ldPT10JiZuLnNwbGljZShpLDEpO2Uuc2V0QXR0cmlidXRlKCJjbGFzcyIsbi5qb2luKCIgIikpfWZ1bmN0aW9uIHNlbGVjdChlKXtmb3IodmFyIHQ9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgic2VsZWN0ZWRJdGVtIiksbj10Lmxlbmd0aC0xO24+PTA7bi0tKXJlbW92ZUNsYXNzKHRbbl0sInNlbGVjdGVkSXRlbSIpO2U/KGFkZENsYXNzKGUsInNlbGVjdGVkSXRlbSIpLGZpbGVOYW1lSW5wdXQudmFsdWU9ZS50ZXh0Q29udGVudCk6ZmlsZU5hbWVJbnB1dC52YWx1ZT0iIn1mdW5jdGlvbiBzZXREaWFsb2dUeXBlKGUpe2RpYWxvZ1R5cGU9ZSxzZWxlY3QobnVsbCksIm9wZW4iPT1lPyh3aW5kb3cub3BlbkJ1dHRvbi5zdHlsZS5kaXNwbGF5PSJpbmxpbmUiLHdpbmRvdy5zYXZlQnV0dG9uLnN0eWxlLmRpc3BsYXk9Im5vbmUiLHdpbmRvdy5maWxlTmFtZUlucHV0LnN0eWxlLmRpc3BsYXk9Im5vbmUiKTood2luZG93Lm9wZW5CdXR0b24uc3R5bGUuZGlzcGxheT0ibm9uZSIsd2luZG93LnNhdmVCdXR0b24uc3R5bGUuZGlzcGxheT0iaW5saW5lIix3aW5kb3cuZmlsZU5hbWVJbnB1dC5zdHlsZS5kaXNwbGF5PSJpbmxpbmUiKX1mdW5jdGlvbiBzaG93TGlzdChlKXtmaWxlc0xpc3QuaW5uZXJIVE1MPSIiO2ZvcihuPTA7bjxlLmxlbmd0aDtuKyspZmlsZXNMaXN0LmlubmVySFRNTCs9JzxkaXYgY2xhc3M9ImZpbGVzTGlzdEl0ZW0iIGRhdGEtdHlwZT0iJytlW25dLnR5cGUrJyI+JytlW25dLm5hbWUrIjwvZGl2PiI7Zm9yKHZhciB0PWZpbGVzTGlzdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJmaWxlc0xpc3RJdGVtIiksbj0wO248dC5sZW5ndGg7bisrKXRbbl0uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLGZ1bmN0aW9uKGUpe2UucHJldmVudERlZmF1bHQoKSxzZWxlY3QoZS50YXJnZXQpfSksdFtuXS5hZGRFdmVudExpc3RlbmVyKCJkYmxjbGljayIsZnVuY3Rpb24oZSl7ZS5wcmV2ZW50RGVmYXVsdCgpLCJmb2xkZXIiPT1lLnRhcmdldC5nZXRBdHRyaWJ1dGUoImRhdGEtdHlwZSIpP3BhcmVudC5wb3N0TWVzc2FnZShbImRpYWxvZ0Jyb3dzZSIsZS50YXJnZXQudGV4dENvbnRlbnRdLCIqIik6Im9wZW4iPT1kaWFsb2dUeXBlP3dpbmRvdy5vcGVuQnV0dG9uLmNsaWNrKCk6d2luZG93LnNhdmVCdXR0b24uY2xpY2soKX0pfXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIixmdW5jdGlvbihlKXtpZihlLmRhdGEgaW5zdGFuY2VvZiBBcnJheSl7dmFyIHQ9ZS5kYXRhLnNoaWZ0KCksbj1lLmRhdGE7InNldERpYWxvZ1R5cGUiPT10P3NldERpYWxvZ1R5cGUoblswXSk6InNob3dMaXN0Ij09dCYmc2hvd0xpc3Qobil9fSwhMSksd2luZG93Lm9ubG9hZD1mdW5jdGlvbigpe2Zvcih2YXIgZT1bImZpbGVzTGlzdCIsImJ1dHRvbnNGb290ZXIiLCJjYW5jZWxCdXR0b24iLCJvcGVuQnV0dG9uIiwic2F2ZUJ1dHRvbiIsImZpbGVOYW1lSW5wdXQiXSx0PTA7dDxlLmxlbmd0aDt0Kyspd2luZG93W2VbdF1dPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVbdF0pO3dpbmRvdy5jYW5jZWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLGZ1bmN0aW9uKCl7dGVsbFBhcmVudChbImRpYWxvZ0NhbmNlbCJdKX0pLHdpbmRvdy5zYXZlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIixmdW5jdGlvbigpe3RlbGxQYXJlbnQoWyJkaWFsb2dTYXZlIixmaWxlTmFtZUlucHV0LnZhbHVlXSl9KSx3aW5kb3cub3BlbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsZnVuY3Rpb24oKXt0ZWxsUGFyZW50KFsiZGlhbG9nT3BlbiIsZmlsZU5hbWVJbnB1dC52YWx1ZV0pfSksc2V0RGlhbG9nVHlwZSgib3BlbiIpLHRlbGxQYXJlbnQoImxvYWRlZCIpfTt2YXIgZGlhbG9nVHlwZTwvc2NyaXB0PjwvaGVhZD48Ym9keT48ZGl2IGlkPSJmaWxlc0xpc3QiPjwvZGl2PjxkaXYgaWQ9ImJ1dHRvbnNGb290ZXIiPjxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iZmlsZU5hbWVJbnB1dCI+IDxpbnB1dCB0eXBlPSJidXR0b24iIHZhbHVlPSJDYW5jZWwiIGlkPSJjYW5jZWxCdXR0b24iPiA8aW5wdXQgdHlwZT0iYnV0dG9uIiB2YWx1ZT0iT3BlbiIgaWQ9Im9wZW5CdXR0b24iPiA8aW5wdXQgdHlwZT0iYnV0dG9uIiB2YWx1ZT0iU2F2ZSIgaWQ9InNhdmVCdXR0b24iPjwvZGl2PjwvYm9keT48L2h0bWw+";!function(){function l(){Z.style.display="block"}function d(){Z.style.display="none"}function i(){var l=Array.prototype.slice.apply(arguments);l.shift().contentWindow.postMessage(l,"*")}function n(){return Z||((Z=document.createElement("iframe")).style.position="absolute",Z.style.top="50%",Z.style.left="50%",Z.style.width="600px",Z.style.height="400px",Z.style.marginTop="-200px",Z.style.marginLeft="-300px",Z.style.border="2px solid black",Z.style.zIndex="100",d(),document.body.appendChild(Z)),Z}function t(l,d){function i(){l.removeEventListener("load",i,!1),d()}l.setAttribute("src",dialogHTML),l.addEventListener("load",i,!1)}function e(l){".."==l?o.pop():o.push(l)}function b(){console.log("Success callback:",Array.prototype.slice.apply(arguments))}function c(){console.log("Failure callback:",Array.prototype.slice.apply(arguments))}var s,Z;setFileSystem=window.setFileSystem=function(l){s=l};var a,o=[];window.addEventListener("message",function(l){if(l.data instanceof Array){var d=l.data.shift(),i=l.data;a&&a(d,i)}}),openFile=window.openFile=function(Z,p,m){Z||(Z=b),p||(p=c);var u=m||n();t(u,function(){s.getAccess(function(){i(u,"setDialogType","open"),a=function(l,i){if("dialogBrowse"==l)e(i[0]),openFile(Z,p);else if("dialogOpen"==l){u!=m&&d();var n=o.concat([i[0]]);Z({path:n,get:function(l,d){l||(l=b),d||(d=c),s.readFile(n,l,d)},update:function(l,d,i){d||(d=b),i||(i=c),s.writeFile(n,l,d,i)}})}else u!=m&&d(),p("User canceled dialog.")},s.readFolder(o,function(l){l.unshift("showList"),i.apply(null,[u].concat(l))},p),u!=m&&l()},p)})},saveFile=window.saveFile=function(Z,p,m){Z||(Z=b),p||(p=c);var u=m||n();t(u,function(){s.getAccess(function(){i(u,"setDialogType","save"),a=function(l,i){if("dialogBrowse"==l)e(i[0]),saveFile(Z,p);else if("dialogSave"==l){u!=m&&d();var n=o.concat([i[0]]);Z({path:n,update:function(l,d,i){d||(d=b),i||(i=c),s.writeFile(n,l,d,i)}})}else u!=m&&d(),p("User canceled dialog.")},s.readFolder(o,function(l){l.unshift("showList"),i.apply(null,[u].concat(l))},p),u!=m&&l()},p)})},JSONFileSystem=window.JSONFileSystem=function(l){function d(d,i){for(var n=l,t=0;t<d.length;t++){if(!n.hasOwnProperty("contents"))throw"Invalid JSON filesystem structure in "+d;if(!n.contents.hasOwnProperty(d[t]))throw"Could not find the folder specified: "+d;n=n.contents[d[t]]}if(n.type!=i)throw"Path does not point to a "+i+": "+d;return n}return{contents:l,getAccess:function(l,d){l()},readFolder:function(i,n,t){try{var e=d(i,"folder"),b=[];for(var c in e.contents)e.contents.hasOwnProperty(c)&&b.push({name:c,type:e.contents[c].type});e!=l&&b.unshift({name:"..",type:"folder"}),n(b)}catch(l){t(l)}},readFile:function(l,i,n){try{i(d(l,"file").contents)}catch(l){n(l)}},writeFile:function(l,i,n,t){try{d(l,"file").contents=i,n("File updated successfully.")}catch(b){if(/Could not find/.test(b))try{var e=(l=l.slice()).pop();d(l,"folder").contents[e]={type:"file",contents:i},n("File written successfully.")}catch(l){t(l)}else t(b)}}}}}();